var FollowMouse=pc.createScript("followMouse");FollowMouse.attributes.add("map",{type:"number",default:10,min:10,max:25}),FollowMouse.prototype.initialize=function(){this.pos=new pc.Vec3,this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this)},FollowMouse.prototype.update=function(t){var o=this.entity;o.getPosition().x>=-1.75*this.map&&o.getPosition().x<1.75*this.map&&o.getPosition().z>=-1.75*this.map&&o.getPosition().z<1.75*this.map?"path"==this.entity.name?o.setLocalScale(3.5,1,3.5):o.setLocalScale(1,1,1):o.setLocalScale(0,0,0)},FollowMouse.prototype.onMouseMove=function(t){var o=this.positioning(t);this.entity.setPosition(o)},FollowMouse.prototype.modFunc=function(t,o){return t-t%o},FollowMouse.prototype.positioning=function(t){var o=Math.PI/180,s=this.app.root.findByName("Main Camera");s.camera.screenToWorld(t.x,t.y,10,this.pos);var e=this.pos.x,i=this.pos.y,n=this.pos.z,a=s.getEulerAngles().x*o,p=s.getEulerAngles().y*o,h=s.getEulerAngles().z*o,l=Math.cos(a)*Math.sin(p)*Math.cos(h)+Math.sin(a)*Math.sin(h),c=Math.cos(a)*Math.sin(p)*Math.sin(h)-Math.sin(a)*Math.cos(h),u=Math.cos(a)*Math.cos(p),M=e-i*l/c,r=n-i*u/c;return new pc.Vec3(this.modFunc(M,3.5),.71,this.modFunc(r,3.5))};var MakeGround=pc.createScript("makeGround");MakeGround.attributes.add("greenModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("earthModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("waterModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("treeModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("stoneModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("map",{type:"number",default:10,min:10,max:25,precision:10}),Object.defineProperty(MakeGround.prototype,"table",{value:[],writable:!0});var ground=new Array(0);MakeGround.prototype.initialize=function(){this.camera=this.app.root.findByName("Camera"),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseUp,this);var e=prompt("Please enter your map size","20");if(null!==e){this.map=e;for(var t=this.app.root.findByName("model holder"),o=0;o<t.children.length;o++)t.children[o].script.followMouse.map=e;this.app.root.findByName("Main Camera").script.orthoHeight.map=e,this.app.fire("makeGround:ortho")}this.setFirstGround()},MakeGround.prototype.setFirstGround=function(){var e,t,o=this.app.root.findByName("Ground Holder"),a=-1.75*this.map,r=1.75*this.map;for(e=a;e<r;e+=3.5){var n="";for(t=a;t<r;t+=3.5){var i=new pc.Entity;i.name="green block",i.addComponent("model"),i.model.type="asset",i.model.asset=this.greenModel,i.setPosition(e,0,t),o.addChild(i);var s=new pc.Vec4(0,e,t,0);ground.push(s),n+="g"}this.table.push(n)}},MakeGround.prototype.setGround=function(e,t,o){String.prototype.replaceAt=function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)};var a,r,n=this.app.root.findByName("Ground Holder"),i=this.app.root.findByName("model holder").children;for(a=0;a<i.length;a++)if(!0===i[a].enabled){r=i[a];break}switch(r.name){case"dirt":0===ground[e].w&&(this.table[t]=this.table[t].replaceAt(o,"r"),ground[e].x=1,n.children[e].name="earth block",n.children[e].model.asset=this.earthModel);break;case"grass":this.table[t]=this.table[t].replaceAt(o,"g"),ground[e].x=0,n.children[e].name="green block",n.children[e].model.asset=this.greenModel;break;case"water":0===ground[e].w&&(this.table[t]=this.table[t].replaceAt(o,"w"),ground[e].x=2,n.children[e].name="water block",n.children[e].model.asset=this.waterModel);break;case"tree":var s=new pc.Entity;s.name="tree block",s.addComponent("model"),s.model.type="asset",s.model.asset=this.treeModel,s.setPosition(ground[e].y,.687,ground[e].z),0===ground[e].x&&0===ground[e].w&&(ground[e].w=1,this.app.root.addChild(s),this.table[t]=this.table[t].replaceAt(o,"A"));break;case"stone":var d=new pc.Entity;d.name="stone block",d.addComponent("model"),d.model.type="asset",d.model.asset=this.stoneModel,d.setPosition(ground[e].y,.687,ground[e].z),0===ground[e].x&&0===ground[e].w&&(ground[e].w=2,this.app.root.addChild(d),this.table[t]=this.table[t].replaceAt(o,"B"));break;case"path":var l=new pc.Entity;if(l.name="path block",l.addComponent("model",{type:"plane"}),l.setLocalScale(3.5,1,3.5),l.setPosition(ground[e].y,.71,ground[e].z),1==ground[e].x&&0===ground[e].w){var p=this.app.root.findByName("New Path");this.checkForRepetition(p,l)||p.addChild(l)}break;case"eraser":if("A"==this.table[t][o]||"B"==this.table[t][o]){this.table[t]=this.table[t].replaceAt(o,"g"),ground[e].x=1,ground[e].w=0;var h=this.app.root.find("name","tree block");h.push.apply(h,this.app.root.find("name","stone block"));var u=new pc.Vec3(ground[e].y,.687,ground[e].z);for(a=0;a<h.length;a++)if(h[a].getPosition().x==u.x&&h[a].getPosition().z==u.z){h[a].destroy();break}}}},MakeGround.prototype.checkForRepetition=function(e,t){for(var o=!1,a=0;a<e.children.length;a++)e.children[a].getPosition().x==t.getPosition().x&&e.children[a].getPosition().z==t.getPosition().z&&(o=!0);return o},MakeGround.prototype.onMouseUp=function(e){for(var t,o=this.app.root.findByName("model holder").children,a=0;a<o.length;a++)if(!0===o[a].enabled){t=o[a];break}if(null!==t&&void 0!==t){var r=t.getPosition().x+1.75*this.map,n=t.getPosition().z+1.75*this.map;a=r/3.5;var i=n/3.5;a-=a%1,i-=i%1;var s=a*this.map+i;a>=0&&i>=0&&a<this.map&&i<this.map&&this.setGround(s,a,i)}};var UiInput=pc.createScript("uiInput");UiInput.attributes.add("hoverAsset",{type:"asset",assetType:"texture"}),UiInput.attributes.add("activeAsset",{type:"asset",assetType:"texture"}),UiInput.prototype.initialize=function(){this.activeCamera=this.app.root.findByName("Main Camera"),this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this)},UiInput.prototype.update=function(e){},UiInput.prototype.onEnter=function(e){this.hovered=!0,e.element.textureAsset=this.hoverAsset,document.body.style.cursor="pointer"},UiInput.prototype.onLeave=function(e){this.hovered=!1,e.element.textureAsset=this.originalTexture,document.body.style.cursor="default"},UiInput.prototype.onPress=function(e){switch(e.element.textureAsset=this.activeAsset,this.entity.name){case"btn_1":this.setCamera("Main Camera");break;case"btn_2":this.setCamera("Camera 2");break;case"btn_3":this.setCamera("Camera 3");break;case"btn_4":this.setCamera("Camera 4");break;case"btn_5":this.setCamera("Camera 5");break;case"btn_6":this.setCamera("Camera 6");break;case"btn_7":this.setCamera("Camera 7");break;case"btn_8":this.setCamera("Camera 8");break;case"btn_9":this.setCamera("Camera 9")}},UiInput.prototype.onRelease=function(e){e.element.textureAsset=this.hovered?this.hoverAsset:this.originalTexture},UiInput.prototype.setCamera=function(e){this.activeCamera.enabled=!1,this.activeCamera=this.app.root.findByName(e),this.activeCamera.enabled=!0};var Toolbar=pc.createScript("toolbar");Toolbar.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Toolbar.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Toolbar.attributes.add("script",{type:"asset",assetType:"script"}),Toolbar.prototype.initialize=function(){var e=document.createElement("style");document.head.appendChild(e),e.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div),this.bindEvents()},Toolbar.prototype.bindEvents=function(){var e=this.app,t=e.root.findByName("model holder").children,r=this.div.querySelector("#green"),n=this.div.querySelector("#earth"),o=this.div.querySelector("#tree"),a=this.div.querySelector("#rock"),d=this.div.querySelector("#eraser"),i=this.div.querySelector("#path"),s=this.app.root.findByName("Main Camera");r.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;e.root.findByName("grass").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1),n.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;e.root.findByName("dirt").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1),o.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;e.root.findByName("tree").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1),a.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;e.root.findByName("stone").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1),d.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;document.body.style.cursor="no-drop",e.root.findByName("eraser").enabled=!0,s.script.mouseInput.runable=!1},!1),i.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;var n=new pc.Entity;n.name="New Path",!1===e.root.findByName("path").enabled&&e.root.addChild(n),e.root.findByName("path").enabled=!0,e.root.findByName("done").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1)};var OrthoHeight=pc.createScript("orthoHeight");OrthoHeight.attributes.add("map",{type:"number",default:10,min:10,max:45}),OrthoHeight.prototype.initialize=function(){var t=this;this.app.on("makeGround:ortho",function(){t.setOrtho()})},OrthoHeight.prototype.setOrtho=function(){this.app.root.findByName("Main Camera").camera.orthoHeight=2.3*this.map};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=this._targetYaw-this._yaw,e=i%360;this._targetYaw=e>180?this._yaw-(360-e):e<-180?this._yaw+(360+e):this._yaw+e}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,i=function(){t._checkAspectRatio()};window.addEventListener("resize",i,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var e=this.entity.getRotation();if(this._yaw=this._calcYaw(e),this._pitch=this._clampPitchAngle(this._calcPitch(e,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var a=new pc.Vec3;a.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(a.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this.on("attr:distanceMax",function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this.on("attr:pitchAngleMin",function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this.on("attr:pitchAngleMax",function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this.on("attr:focusEntity",function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)}),this.on("attr:frameOnStart",function(t,i){t&&this.focus(this.focusEntity||this.app.root)}),this.on("destroy",function(){window.removeEventListener("resize",i,!1)})},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var LogReader=pc.createScript("logReader");LogReader.attributes.add("log",{type:"asset",assetType:"json"}),LogReader.attributes.add("attacker_statBar",{type:"entity"}),LogReader.attributes.add("defender_statBar",{type:"entity"}),window.setLog=function(e){this.gameLog=e.resource},LogReader.prototype.initialize=function(){this.counter=0,this.time=0,this.gameLog=JSON.parse(document.getElementById("storage"))},LogReader.prototype.update=function(e){if(this.time%13==0&&this.counter<this.gameLog.length&&1==this.app.timeScale){var t=this.gameLog[this.counter];"init"==t.name?(this.app.fire("logReader:init",t),this.initStats(t)):"turn"==t.name?(this.setAttackerStats(t),this.setDefenderStats(t),this.createTowers(t),this.creatUnit(t),this.shootTowers(t),this.moveUnits(t),this.destroyTowers(t),this.sendStorm(t),this.sendBean(t),this.deadUnits(t),this.endOfPath(t)):"status"==t.name&&(this.app.fire("logReader:setTurnA",t.args[0]),this.app.fire("logReader:setTurnD",t.args[0])),++this.counter}this.time++},LogReader.prototype.initStats=function(e){var t=e.args[0].params,r={health:t[0],money:t[1],bean:t[3],storm:t[4],income:0};this.app.fire("logReader:statsBarA",r),this.app.fire("logReader:setTurnA",0),this.app.fire("logReader:statsBarD",r),this.app.fire("logReader:setTurnD",0)},LogReader.prototype.setAttackerStats=function(e){var t=e.args[0].players[0],r={health:t[0],money:t[1],income:t[2],bean:t[3],storm:t[4]};this.app.fire("logReader:statsBarA",r)},LogReader.prototype.setDefenderStats=function(e){var t=e.args[0].players[1],r={health:t[0],money:t[1],income:t[2],bean:t[3],storm:t[4]};this.app.fire("logReader:statsBarD",r)},LogReader.prototype.createTowers=function(e){for(var t=e.args[0].events.updtowers,r=0;r<t.length;r++){var a=t[r];if(a[3]){var o=this.getTowerProperties(e,a[1]);this.app.fire("logReader:createTower",a[0],a[1],a[2],o[0],o[1])}else this.app.fire("logReader:updateTower",a[0],a[1],a[2])}},LogReader.prototype.shootTowers=function(e){for(var t=e.args[0].events.archer,r=0;r<t.length;r++){var a=t[r];this.app.fire("logReader:archerEvent",a[0],a[1])}var o=e.args[0].events.cannon;for(r=0;r<o.length;r++){var s=o[r];this.app.fire("logReader:cannonEvent",s[0],s[1])}},LogReader.prototype.destroyTowers=function(e){var t=e.args[0].events.destroyedtowers;for(i=0;i<t.length;i++){var r=t[i];this.app.fire("logReader:destroyTower",r[0],r[1])}},LogReader.prototype.getTowerProperties=function(e,t){for(var r,a=e.args[0].towers,o=0;o<a.length;o++)a[o][1].toString()==t.toString()&&(r=[a[o][2],a[o][4]]);return r},LogReader.prototype.creatUnit=function(e){var t=e.args;this.app.fire("logReader:unitData",t)},LogReader.prototype.moveUnits=function(e){var t=e.args[0].units;this.app.fire("logReader:moveUnits",t)},LogReader.prototype.deadUnits=function(e){var t=e.args[0].events.deadunits;this.app.fire("logReader:destroyUnit",t)},LogReader.prototype.sendStorm=function(e){for(var t=e.args[0].events.storms,r=0;r<t.length;r++)this.app.fire("logReader:sendStorm",t[r][0],t[r][1])},LogReader.prototype.sendBean=function(e){for(var t=e.args[0].events.beans,r=0;r<t.length;r++)this.app.fire("logReader:sendBean",t[r][0],t[r][1])},LogReader.prototype.endOfPath=function(e){for(var t=e.args[0].events.endofpath,r=0;r<t.length;r++)this.app.fire("logReader:endofpath",t[r][0],t[r][1])};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),Object.defineProperty(MouseInput.prototype,"runable",{value:!0,writable:!0}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,o=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",o,!1),this.on("destroy",function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",o,!1)})}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.entity.getPosition().y<.1&&(i.y=.1),this.orbitCamera.pivotPoint.add(i),this.oldWorldDiff=i},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){if(!1!==this.runable)switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){if(!1!==this.runable){pc.app.mouse;this.lookButtonDown?(this.entity.getPosition().y<.1?this.orbitCamera.pitch-=.1:this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)}},MouseInput.prototype.onMouseWheel=function(t){!1!==this.runable&&(this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault())},MouseInput.prototype.onMouseOut=function(t){!1!==this.runable&&(this.lookButtonDown=!1,this.panButtonDown=!1)};var ClosePlacing=pc.createScript("closePlacing");ClosePlacing.attributes.add("hoverAsset",{type:"asset",assetType:"texture"}),ClosePlacing.attributes.add("activeAsset",{type:"asset",assetType:"texture"}),ClosePlacing.prototype.initialize=function(){this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this)},ClosePlacing.prototype.update=function(e){},ClosePlacing.prototype.onPress=function(e){e.element.textureAsset=this.activeAsset;for(var t=this.app.root.findByName("model holder").children,o=0;o<t.length;o++)t[o].enabled=!1;this.app.root.findByName("done").enabled=!1;var s=this.app.root.findByName("New Path");null!==s&&void 0!==s&&(s.enabled=!1,this.app.root.removeChild(s)),this.app.root.findByName("Main Camera").script.mouseInput.runable=!0,this.app.root.findByName("Ground Holder").script.makeGround.removeMode=!1},ClosePlacing.prototype.onEnter=function(e){this.hovered=!0,e.element.textureAsset=this.hoverAsset,document.body.style.cursor="pointer"},ClosePlacing.prototype.onLeave=function(e){this.hovered=!1,e.element.textureAsset=this.originalTexture,document.body.style.cursor="default"},ClosePlacing.prototype.onRelease=function(e){e.element.textureAsset=this.hovered?this.hoverAsset:this.originalTexture};var DynamicSize=pc.createScript("dynamicSize");DynamicSize.prototype.initialize=function(){this.app.root.findByName("dirt")},DynamicSize.prototype.update=function(i){};var AddPath=pc.createScript("addPath");AddPath.prototype.initialize=function(){this.entity.element.on("mouseup",this.onMouseUp,this),this.entity.element.on("mouseenter",function(){document.body.style.cursor="pointer"},this),this.entity.element.on("mouseleave",function(){document.body.style.cursor="default"},this)},AddPath.prototype.update=function(e){},AddPath.prototype.onMouseUp=function(){for(var e=this.app.root.findByName("New Path"),t=!1,n=this.app.root.findByName("Full Path"),i=0;i<n.children.length;i++)if(n.children[i].children.length==e.children.length){for(var o=!0,d=0;d<e.children.length;d++)if(e.children[d].getPosition().x!=n.children[i].children[d].getPosition().x&&e.children[d].getPosition().z!=n.children[i].children[d].getPosition().z){o=!1;break}if(!0===o){t=!0;break}}this.app.root.removeChild(e),!1===t&&n.addChild(e),e.name="Done Path",e.enabled=!1,this.app.root.findByName("path").enabled=!1,this.app.root.findByName("done").enabled=!1};var Tower=pc.createScript("tower");Tower.prototype.initialize=function(){this.lvl=1,this.changeTo=null,this.shrink=!1,this.expand=!1,this.run=!1},Tower.prototype.update=function(t){var e=this.entity.getLocalScale();e.y>=.01&&this.shrink&&this.run?this.entity.setLocalScale(e.x-8*t,e.y-8*t,e.z-8*t):this.shrink&&this.run&&(this.shrink=!1,this.expand=!0,this.entity.model.asset=this.changeTo),e.y<=1&&this.expand&&this.run?this.entity.setLocalScale(e.x+8*t,e.y+8*t,e.z+8*t):this.expand&&this.run&&(this.expand=!1,this.run=!1)},Tower.prototype.archerShoot=function(t){var e=this.entity.parent.parent.findByName("Units").findByName("unit "+t.toString()),i=this.entity.parent.parent.findByName("arrow");this.bullet=i.clone(),this.bullet.setLocalPosition(0,3.4,.5),this.bullet.enabled=!0,this.entity.addChild(this.bullet);var s=e.getPosition();this.entity.lookAt(s);var n=this.entity.parent.parent.findByName("smoke");this.aSmoke=n.clone(),this.aSmoke.enabled=!0,this.entity.addChild(this.aSmoke)},Tower.prototype.cannonShoot=function(t){var e=this.entity.parent.parent.findByName("smoke");this.smoke=e.clone(),this.smoke.enabled=!0,this.entity.addChild(this.smoke);var i=this.entity.parent.parent.findByName("explosion");this.explode=i.clone(),this.explode.enabled=!0,this.entity.addChild(this.explode);var s,n=Math.sqrt(this.entity.parent.parent.findByName("Ground").children.length);new pc.Vec3(this.convXY(t.y,n),1,this.convXY(t.x,n));s="Attacker"==this.entity.parent.parent.name?-200:200;var h=new pc.Vec3(-1*this.convXY(t.x,n)+s,1,-1*this.convXY(t.y,n));this.smoke.setLocalPosition(.1,3.1+1.2*(this.lvl-1),-1.3),this.smoke.particlesystem.reset(),this.smoke.particlesystem.play(),this.entity.lookAt(h)},Tower.prototype.levelUp=function(t){this.lvl=t,this.lvl<=2||(this.lvl<=5?10980435==this.entity.model.asset||10980439==this.entity.model.asset?(this.changeTo=this.app.assets.get(10980439),this.run=!0,this.shrink=!0):(this.changeTo=this.app.assets.get(10980476),this.run=!0,this.shrink=!0):this.lvl<=8?10980439==this.entity.model.asset||10980443==this.entity.model.asset?(this.changeTo=this.app.assets.get(10980443),this.run=!0,this.shrink=!0):(this.changeTo=this.app.assets.get(10980480),this.run=!0,this.shrink=!0):10980443==this.entity.model.asset||10980448==this.entity.model?(this.changeTo=this.app.assets.get(10980448),this.run=!0,this.shrink=!0):(this.changeTo=this.app.assets.get(10980484),this.run=!0,this.shrink=!0))},Tower.prototype.convXY=function(t,e){return-1.75*e+3.5*t+1.75};var Game=pc.createScript("Game");Game.attributes.add("hoverAsset",{type:"asset",assetType:"texture"}),Game.attributes.add("activeAsset",{type:"asset",assetType:"texture"}),Game.prototype.initialize=function(){this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseleave",this.onLeave,this)},Game.prototype.update=function(e){},Game.prototype.onRelease=function(e){if(e.element.textureAsset=this.hovered?this.hoverAsset:this.originalTexture,!0===confirm("Do you want to continue ?")){for(var t=this.app.root.findByName("Ground Holder"),o=t.script.makeGround.map,s=o,n=[],i=this.app.root.findByName("Full Path"),r=i.children,a=0;a<r.length;a++){for(var h=r[a].children,u=[],p=0;p<h.length;p++){var l=(h[p].getPosition().x+1.75*o)/3.5,m=(h[p].getPosition().z+1.75*s)/3.5;l-=l%1,m-=m%1;var d={x:m,y:l};u.push(d)}var c={len:h.length,cells:u};n.push(c)}var y=t.script.makeGround.table,v=[50,2e3,1e3,3,3,2,[[40,16,32,1.3,8,2,2,1,2,60,3],[180,60,240,1.3,25,8,4,5,2,15,10]],[[150,50,1.5,40,1.4,3,2,0],[200,70,1.5,10,1.4,4,2,0]]],f={size:[o,s],cells:y},G={map:f,paths:n,params:v},x=[G],A=JSON.stringify(x);this.download("map.map",A),(new XMLHttpRequest).open("GET","",!0)}},Game.prototype.download=function(e,t){var o=document.createElement("a");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),o.setAttribute("download",e),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)},Game.prototype.onEnter=function(e){this.hovered=!0,e.element.textureAsset=this.hoverAsset,document.body.style.cursor="pointer"},Game.prototype.onLeave=function(e){this.hovered=!1,e.element.textureAsset=this.originalTexture,document.body.style.cursor="default"},Game.prototype.onPress=function(e){e.element.textureAsset=this.activeAsset};var Pause=pc.createScript("pause");Object.defineProperty(Pause.prototype,"isPaused",{value:!1,writable:!0}),Pause.prototype.initialize=function(){this.isPaused=!1},Pause.prototype.update=function(e){this.app.mouse.wasPressed(pc.MOUSEBUTTON_LEFT)&&this.togglePaused()},Pause.prototype.togglePaused=function(){this.isPaused?this.app.timeScale=1:this.app.timeScale=0,this.isPaused=!this.isPaused};var Resume=pc.createScript("Resume");Resume.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Resume.attributes.add("rsm_html",{type:"asset",assetType:"html",title:"HTML Asset"}),Resume.prototype.initialize=function(){var e=document.createElement("style");document.head.appendChild(e),e.innerHTML=this.css.resource||"",this.btndiv=document.createElement("div"),this.btndiv.classList.add("resume"),this.btndiv.innerHTML=this.rsm_html.resource||"",document.body.appendChild(this.btndiv)},Resume.prototype.update=function(e){var t=this.btndiv.querySelector("#button"),s=this.app;t.addEventListener("click",function(){var e=s.root.findByName("Attacker"),t=s.root.findByName("Defender");s.timeScale=1,e.script.pause.isPaused=!1,t.script.pause.isPaused=!1,s.root.findByName("resume").enabled=!1},!1)};var StatsBar=pc.createScript("statsBarA");StatsBar.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),StatsBar.attributes.add("bar_html",{type:"asset",assetType:"html",title:"HTML Asset"}),StatsBar.attributes.add("log",{type:"asset",assetType:"json"}),StatsBar.prototype.initialize=function(){this.suffix="A";var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"+this.suffix),this.div.innerHTML=this.bar_html.resource||"",document.body.appendChild(this.div),this.timer=0;var e=this;this.app.on("logReader:statsBarA",function(t){e.statusUpdate(t)}),this.app.on("logReader:setTurnA",function(t){e.setTurn(t)})},StatsBar.prototype.update=function(t){},StatsBar.prototype.statusUpdate=function(t){var e=this.div.querySelector("#money"+this.suffix),s=this.div.querySelector("#health"+this.suffix),i=this.div.querySelector("#income"+this.suffix),a=this.div.querySelector("#storm"+this.suffix),r=this.div.querySelector("#bean"+this.suffix);e.textContent=t.money,s.textContent=t.health,i.textContent=t.income,a.textContent=t.storm,r.textContent=t.bean},StatsBar.prototype.setTurn=function(t){this.turn=t,this.div.querySelector("#turn"+this.suffix).textContent=this.turn};var Init=pc.createScript("init");Init.attributes.add("side",{type:"entity"}),Init.attributes.add("grassModel",{type:"asset",assetType:"model"}),Init.attributes.add("earthModel",{type:"asset",assetType:"model"}),Init.attributes.add("sandModel",{type:"asset",assetType:"model"}),Init.attributes.add("waterModel",{type:"asset",assetType:"model"}),Init.attributes.add("redTreeModel",{type:"asset",assetType:"model"}),Init.attributes.add("blueTreeModel",{type:"asset",assetType:"model"}),Init.attributes.add("rockModel",{type:"asset",assetType:"model"}),Init.prototype.initialize=function(){var t=this;this.app.on("logReader:init",function(e){t.makeFirstBase(e)})},Init.prototype.makeFirstBase=function(t){var e=this.getMapString(t);this.side.findByName("Camera").camera.orthoHeight=3*this.getSize(t),this.drawMap(t,e)},Init.prototype.drawMap=function(t,e){for(var a=this.side.findByName("Ground"),i=this.side.findByName("Blocks"),s=0;s<e.length;s++){var d=this.getXZ(t,s)[0],o=this.getXZ(t,s)[1];"g"==e[s]?"Attacker"==this.side.name?this.addToMap("sand",this.sandModel,a,d,0,o):this.addToMap("water",this.waterModel,a,d,0,o):"r"==e[s]?(this.clearXZ(d,o),this.addToMap("road",this.earthModel,a,d,0,o)):"w"==e[s]?"Attacker"==this.side.name?this.addToMap("sand",this.sandModel,a,d,0,o):this.addToMap("water",this.waterModel,a,d,0,o):"A"==e[s]?(this.clearXZ(d,o),"Attacker"==this.side.name?(this.addToMap("sand",this.sandModel,a,d,0,o),this.addToMap("red tree",this.redTreeModel,i,d,.705,o)):(this.addToMap("water",this.waterModel,a,d,0,o),this.addToMap("blue tree",this.blueTreeModel,i,d,.705,o))):"B"!=e[s]&&"b"!=e[s]||(this.clearXZ(d,o),"Attacker"==this.side.name?this.addToMap("sand",this.sandModel,a,d,0,o):this.addToMap("water",this.waterModel,a,d,0,o),this.addToMap("rock",this.rockModel,i,d,.705,o))}},Init.prototype.getSize=function(t){return t.args[0].map.size[0]},Init.prototype.getMapString=function(t){for(var e=t.args[0].map.cells,a="",i=0;i<e.length;i++)a+=e[i];return a},Init.prototype.addToMap=function(t,e,a,i,s,d){var o=new pc.Entity;o.name=t,o.addComponent("model"),o.model.type="asset",o.model.asset=e,o.setPosition(i,s,d),a.addChild(o)},Init.prototype.getXZ=function(t,e){var a=this.getSize(t);return[-1.75*a+3.5*Math.floor(e/a)+1.75,-1.75*a+e%a*3.5+1.75]},Init.prototype.clearXZ=function(t,e){for(var a=this.app.root.findByName("Blocks").children,i=0;i<a.length;i++)if(a[i].getPosition().x==t&&a[i].getPosition().z==e){a[i].destroy();break}};var StatsBar=pc.createScript("statsBarD");StatsBar.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),StatsBar.attributes.add("bar_html",{type:"asset",assetType:"html",title:"HTML Asset"}),StatsBar.attributes.add("log",{type:"asset",assetType:"json"}),StatsBar.prototype.initialize=function(){this.suffix="D";var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"+this.suffix),this.div.innerHTML=this.bar_html.resource||"",document.body.appendChild(this.div),this.timer=0;var e=this;this.app.on("logReader:statsBarD",function(t){e.statusUpdate(t)}),this.app.on("logReader:setTurnD",function(t){e.setTurn(t)})},StatsBar.prototype.update=function(t){},StatsBar.prototype.statusUpdate=function(t){var e=this.div.querySelector("#money"+this.suffix),s=this.div.querySelector("#health"+this.suffix),i=this.div.querySelector("#income"+this.suffix),a=this.div.querySelector("#storm"+this.suffix),r=this.div.querySelector("#bean"+this.suffix);e.textContent=t.money,s.textContent=t.health,i.textContent=t.income,a.textContent=t.storm,r.textContent=t.bean},StatsBar.prototype.setTurn=function(t){this.turn=t,this.div.querySelector("#turn"+this.suffix).textContent=this.turn};var TowerHandler=pc.createScript("towerHandler");TowerHandler.attributes.add("archer",{type:"asset",assetType:"model"}),TowerHandler.attributes.add("cannon",{type:"asset",assetType:"model"}),TowerHandler.attributes.add("blueTree",{type:"asset",assetType:"model"}),TowerHandler.attributes.add("redTree",{type:"asset",assetType:"model"}),TowerHandler.prototype.initialize=function(){var e=this;this.app.on("logReader:createTower",function(t,r,o,n,a){e.createTower(t,r,o,n,a)}),this.app.on("logReader:updateTower",function(t,r,o){e.updateTower(t,r,o)}),this.app.on("logReader:cannonEvent",function(t,r){e.cannonEvent(t,r)}),this.app.on("logReader:archerEvent",function(t,r){e.archerEvent(t,r)})},TowerHandler.prototype.update=function(e){},TowerHandler.prototype.createTower=function(e,t,r,o,n){var a=new pc.Entity;a.name="tower"+t.toString();var i;0===e?i=this.app.root.findByName("Attacker").findByName("Towers"):1==e&&(i=this.app.root.findByName("Defender").findByName("Towers"));var d=Math.sqrt(i.parent.findByName("Ground").children.length);a.setPosition(this.convXY(n.y,d),.5,this.convXY(n.x,d)),i.addChild(a);var p;"c"==o?p=this.cannon:"a"==o&&(p=this.archer),a.addComponent("model"),a.model.type="asset",a.model.asset=p,a.addComponent("script"),a.script.create("tower"),a.script.create("beanOnTower")},TowerHandler.prototype.updateTower=function(e,t,r){var o;if(o=0===e?this.app.root.findByName("Attacker").findByName("Towers"):this.app.root.findByName("Defender").findByName("Towers"),null!==t){o.findByName("tower"+t.toString()).script.tower.levelUp(r)}},TowerHandler.prototype.cannonEvent=function(e,t){this.findTower(e).script.tower.cannonShoot(t)},TowerHandler.prototype.archerEvent=function(e,t){this.findTower(e).script.tower.archerShoot(t)},TowerHandler.prototype.findTower=function(e){var t=this.app.root.findByName("Attacker").findByName("Towers"),r=this.app.root.findByName("Defender").findByName("Towers"),o=t.findByName("tower"+e.toString());return null!==o&&void 0!==o?o:null!==(o=r.findByName("tower"+e.toString()))&&void 0!==o?o:(alert("not found"),null)},TowerHandler.prototype.convXY=function(e,t){return-1.75*t+3.5*e+1.75};var UnitHandler=pc.createScript("unitHandler");UnitHandler.prototype.initialize=function(){var t=this;this.app.on("logReader:unitData",function(n){t.addNewUnit(n[0])}),this.app.on("logReader:moveUnits",function(n){t.move(n)}),this.app.on("logReader:destroyUnit",function(n){t.destroyUnit(n)}),this.app.on("logReader:endofpath",function(n,e){t.endofpath(n,e)})},UnitHandler.prototype.update=function(t){},UnitHandler.prototype.addNewUnit=function(t){for(var n=t.events.newunits,e=0;e<n.length;e++){var i=n[e];this.app.fire("unitHandler:addNewUnit",i[0],i[1][0],i[1][1],i[1][2],i[1][3],i[1][4],i[1][5],i[1][6])}},UnitHandler.prototype.move=function(t){for(var n=0;n<t.length;n++){var e=t[n],i=e[1],o=e[5],a=e[4],r=e[8],d=this.entity.findByName("unit "+i.toString());if(null!==d&&void 0!==d){var l=new pc.Vec3(this.getLocation(o.y)+3*Math.random()-1.5,.7,this.getLocation(o.x)+3*Math.random()-1.5);d.script.unitMove.movePlayerTo(l);var p=a/r;d.setLocalScale(d.getLocalScale().x*p,d.getLocalScale().y*p,d.getLocalScale().z*p)}}},UnitHandler.prototype.destroyUnit=function(t){for(var n=t,e=0;e<n.length;e++){var i=n[e][1],o=this.entity.findByName("unit "+i.toString());null!==o&&void 0!==o&&o.destroy()}},UnitHandler.prototype.endofpath=function(t,n){var e=this.entity.findByName("unit "+n.toString());null!==e&&void 0!==e&&e.destroy()},UnitHandler.prototype.getLocation=function(t){return-1.75*Math.sqrt(this.entity.parent.findByName("Ground").children.length)+3.5*t+1.75};var CreateUnits=pc.createScript("createUnits");CreateUnits.attributes.add("mid",{type:"number",enum:[{Attacker:0},{Defender:1}]}),CreateUnits.attributes.add("light",{type:"asset",assetType:"model"}),CreateUnits.attributes.add("heavy",{type:"asset",assetType:"model"}),CreateUnits.prototype.initialize=function(){var t=this;this.app.on("unitHandler:addNewUnit",function(e,i,n,a,o,s,d,r){t.mid==e&&t.addNewUnit(i,n,a,o,s,d,r)})},CreateUnits.prototype.addNewUnit=function(t,e,i,n,a,o,s){null===this.entity.findByName("unit "+t.toString())&&this.addToMap(t,e,i,n,a,s)},CreateUnits.prototype.addToMap=function(t,e,i,n,a,o){var s=new pc.Entity;s.name="unit "+t.toString(),s.addComponent("model"),s.model.type="asset",s.model.asset="l"==e?this.light:this.heavy,s.setLocalPosition(this.getLocation(a.y)+3*Math.random()-1.5,.7,this.getLocation(a.x)+3*Math.random()-1.5),this.entity.addChild(s),s.addComponent("script"),s.script.create("unitMove")},CreateUnits.prototype.getLocation=function(t){return-1.75*Math.sqrt(this.entity.parent.findByName("Ground").children.length)+3.5*t+1.75};var UnitMove=pc.createScript("unitMove");UnitMove.prototype.initialize=function(){this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.speed=6},UnitMove.newPosition=new pc.Vec3,UnitMove.prototype.update=function(t){if(this.direction.lengthSq()>0){var i=this.speed*t,e=UnitMove.newPosition;e.copy(this.direction).scale(i),e.add(this.entity.getLocalPosition()),this.entity.setLocalPosition(e),this.distanceToTravel-=i,this.distanceToTravel<=0&&(this.entity.setLocalPosition(this.targetPosition),this.direction.set(0,0,0))}},UnitMove.prototype.movePlayerTo=function(t){this.targetPosition.copy(t),this.targetPosition.y=this.entity.getLocalPosition().y,this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.entity.getLocalPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.entity.lookAt(this.targetPosition,this.entity.up)):this.direction.set(0,0,0)};var BeanOnTower=pc.createScript("beanOnTower");BeanOnTower.prototype.initialize=function(){var t=this,e=this.app;this.shrink=!0,this.expand=!1,this.run=!1,this.smoke=null,this.redTree=this.app.assets.get(10794747),this.blueTree=this.app.assets.get(10886611),this.app.on("logReader:destroyTower",function(i,s){if(t.entity.name=="tower"+s.toString()){var n=e.root.findByName("bean smoke");t.entity.getPosition();t.smoke=n.clone(),t.entity.addChild(t.smoke),t.smoke.setLocalPosition(0,0,0),t.smoke.particlesystem.play(),t.run=!0,t.mid=i}})},BeanOnTower.prototype.update=function(t){var e=this.entity.getLocalScale();e.y>=.01&&this.shrink&&this.run?this.entity.setLocalScale(e.x-1.3*t,e.y-1.3*t,e.z-1.3*t):this.shrink&&this.run&&(this.shrink=!1,this.expand=!0,0===this.mid?this.entity.model.asset=this.redTree:this.entity.model.asset=this.blueTree),e.y<=1&&this.expand&&this.run?this.entity.setLocalScale(e.x+2*t,e.y+2*t,e.z+2*t):this.expand&&this.run&&(this.expand=!1,this.entity.script.destroy("beanOnTower"))};var Shoot=pc.createScript("shoot");Shoot.prototype.initialize=function(){},Shoot.newPosition=new pc.Vec3,Shoot.prototype.update=function(t){var i=this.explode;if(this.direction.lengthSq()>0){var e=this.speed*t,o=Shoot.newPosition;o.copy(this.direction).scale(e),o.add(this.entity.getLocalPosition()),this.entity.setLocalPosition(o),this.distanceToTravel-=e,this.distanceToTravel<=0&&(this.entity.setLocalPosition(this.targetPosition),this.direction.set(0,0,0))}else{if(null!==i){var s=this.entity.getLocalPosition();i.setLocalPosition(s.x,1.5,s.z),i.particlesystem.reset(),i.particlesystem.play()}this.entity.destroy()}},Shoot.prototype.movePlayerTo=function(t,i,e){this.explode=i,this.smoke=e,null!==this.smoke&&(this.smoke.particlesystem.reset(),this.smoke.particlesystem.play()),this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.speed=20,this.targetPosition.copy(t),this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.entity.getLocalPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.entity.lookAt(this.targetPosition)):this.direction.set(0,0,0)};var Storm=pc.createScript("storm");Storm.prototype.initialize=function(){var t=this;this.app.on("logReader:sendStorm",function(o,r){t.sendStorm(o,r)})},Storm.prototype.sendStorm=function(t,o){var r=this.app.root.findByName("storm"),i=r.clone();0===t?this.app.root.findByName("Attacker").addChild(i):this.app.root.findByName("Defender").addChild(i),i.setLocalPosition(this.convXY(o.x),1.5,this.convXY(o.y)),i.particlesystem.play()},Storm.prototype.convXY=function(t){return-1.75*Math.sqrt(this.app.root.findByName("Ground").children.length)+3.5*t+1.75};var BeanOnNull=pc.createScript("beanOnNull");BeanOnNull.attributes.add("side",{type:"number",enum:[{Attacker:0},{Defender:1}]}),BeanOnNull.prototype.initialize=function(){var e=this,t=this.app;this.expand=!1,this.run=!1,this.smoke=null,this.redTree=this.app.assets.get(10794747),this.blueTree=this.app.assets.get(10886611),this.app.on("logReader:setBean",function(n,i){if(n==e.side){var s=t.root.findByName("bean smoke");e.entity.getPosition();e.smoke=s.clone(),e.entity.findByName("Ground").addChild(e.smoke),e.smoke.setLocalPosition(e.convXY(i.y),.7,e.convXY(i.x)),e.smoke.particlesystem.play(),e.run=!0}})},BeanOnNull.prototype.update=function(e){},BeanOnNull.prototype.createNewTree=function(e){var t=new pc.Entity;t.addComponent("model"),t.model.type="asset",0===this.side?t.model.asset=this.redTree:t.model.asset=this.blueTree,t.setPosition(this.convXY(e.y),.7,this.convXY(e.x)),this.entity.findByName("Blocks").addChild(t)},BeanOnNull.prototype.convXY=function(e){return-1.75*Math.sqrt(this.app.root.findByName("Ground").children.length)+3.5*e+1.75};var RotateTower=pc.createScript("rotateTower");RotateTower.prototype.initialize=function(){var t=this.entity.getEulerAngles();this.base=new pc.Vec3(Math.sin(t.y*Math.PI/180),0,Math.cos(t.y*Math.PI/180));var e=new pc.Vec3(0,1,0);this.rotate=this.findAngle(this.direction(e)),this.rotated=0,this.entity.lookAt(e)},RotateTower.prototype.update=function(t){},RotateTower.prototype.findAngle=function(t){var e=180*Math.acos(this.base.dot(t.normalize()))/Math.PI;return e=this.base.x<0?e:-e},RotateTower.prototype.direction=function(t){var e=(new pc.Vec3(1,0,1).normalize(),new pc.Vec3);return e.sub2(t,this.entity.getPosition()),e.y=0,e};var Move=pc.createScript("moveBullet");Move.prototype.initialize=function(){this.startTime=0,this.duration=.25,this.run=!1,this.time=pc.math.clamp(this.startTime,0,this.duration),this.lookAt=new pc.Vec3,this.up=new pc.Vec3},Move.prototype.update=function(t){if(this.run){this.time+=t,this.time>this.duration&&(null!==this.explode&&(this.explode.setLocalPosition(this.entity.getLocalPosition()),this.explode.particlesystem.reset(),this.explode.particlesystem.play()),this.entity.destroy());var i=this.time/this.duration;this.entity.setLocalPosition(this.px.value(i),this.py.value(i),this.pz.value(i)),this.lookAt.set(this.tx.value(i),this.ty.value(i),this.tz.value(i)),this.up.set(this.ux.value(i),this.uy.value(i),this.uz.value(i)),this.entity.lookAt(this.lookAt,this.up)}},Move.prototype.createPath=function(t,e,s){var h=pc.CURVE_CARDINAL;this.explode=s,this.px=new pc.Curve,this.px.type=h,this.py=new pc.Curve,this.py.type=h,this.pz=new pc.Curve,this.pz.type=h,this.tx=new pc.Curve,this.tx.type=h,this.ty=new pc.Curve,this.ty.type=h,this.tz=new pc.Curve,this.tz.type=h,this.ux=new pc.Curve,this.ux.type=h,this.uy=new pc.Curve,this.uy.type=h,this.uz=new pc.Curve,this.uz.type=h;var p=[t,e],o=0,a=[],u=new pc.Vec3;for(a.push(0),i=1;i<p.length;i++){var n=p[i-1],r=p[i];u.sub2(n.getLocalPosition(),r.getLocalPosition()),o+=u.length(),a.push(o)}for(i=0;i<p.length;i++){var l=a[i]/o,y=p[i],c=y.getLocalPosition();this.px.add(l,c.x),this.py.add(l,c.y),this.pz.add(l,c.z);var d=c.clone().add(y.forward);this.tx.add(l,d.x),this.ty.add(l,d.y),this.tz.add(l,d.z);var v=y.up;this.ux.add(l,v.x),this.uy.add(l,v.y),this.uz.add(l,v.z)}this.run=!0};